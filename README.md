# Прогнозирование продаж блюд с использованием XGBoost

- Подготовку временных рядов
- Генерацию признаков
- Обучение модели
- Визуализацию результатов

---

## Содержание
1. [Структура данных](#структура-данных)
2. [Установка зависимостей](#установка-зависимостей)
3. [Переменные модели](#переменные-модели)
4. [Подходы в решении](#подходы-в-решении)
5. [Использование](#использование)
6. [Результаты](#результаты)

---

### Структура данных
Для работы требуется Excel-файл `x.xlsx` с колонками:
- **OpenDate.Typed** — дата продажи (формат: `год-месяц-день`)
- **DishName** — название блюда
- **DishAmountInt** — количество проданных порций

Пример данных:
| OpenDate.Typed | DishName | DishAmountInt |
|----------------|----------|---------------|
| 2023-01-01     | Ролл     | 15            |
| 2023-01-01     | Салат    | 8             |

---

### Установка зависимостей
Установите необходимые библиотеки через pip:
```
pip install pandas numpy xgboost matplotlib seaborn scikit-learn 
```

---

### Переменные модели
Модель использует 4 группы признаков:

#### 1. **Временные признаки**
- **Почему важны:** Позволяют уловить сезонность и еженедельные паттерны
- **Признаки:**
  - `day_of_week` — день недели (0=Пн, 6=Вс)
  - `month` — месяц года (1-12)
  - `day_of_month` — день месяца (1-31)
  - `is_weekend` — признак выходного дня (True/False)
  - `quarter` — квартал года (1-4)

#### 2. **Лаговые признаки**
- **Почему важны:** Показывают исторические продажи
- **Признаки:**
  - `lag_1`, `lag_2`, `lag_7`, `lag_14`, `lag_28` — продажи за 1/2/7/14/28 дней до текущей даты

#### 3. **Скользящие статистики**
- **Почему важны:** Учитывают тренды и волатильность
- **Признаки для окон 3/7/14/28/60 дней:**
  - `rolling_mean_X` — средние продажи за X дней
  - `rolling_std_X` — стандартное отклонение продаж
  - `rolling_max_X` — максимальные продажи

#### 4. **Дополнительные признаки**
- **Почему важны:** Учитывают взаимосвязи между признаками
- **Признаки:**
  - `day_month_interaction` — взаимодействие дня недели и месяца
  - `sales_trend` — разница с предыдущим днём
  - `DishName_encoded` — числовой код блюда

---

### Подходы в решении
1. **Временное разделение данных**
   - Тестовая выборка: последние 60 дней (последние 2 месяца)
   - Обучающая выборка: все данные до тестового периода
   - **Почему:** Модель не должна "видеть будущее" при прогнозировании

2. **Генерация признаков**
   - Для каждого блюда рассчитываются лаги и скользящие статистики
   - **Важно:** Все вычисления делаются в рамках доступных на момент прогноза данных

3. **Обучение модели**
   - Используется XGBoost с гиперпараметрами (подобраны с помощью GridSearchCV):
     - `n_estimators=400` — 400 деревьев
     - `max_depth=6` — глубина деревьев
     - `learning_rate=0.1` — скорость обучения

4. **Оценка качества**
   - Метрики рассчитываются только для дней с ненулевыми продажами:
     - **MAE:** Средняя абсолютная ошибка
     - **RMSE:** Среднеквадратичная ошибка
     - **MAPE:** Средняя абсолютная процентная ошибка
     - **R²:** Коэффициент детерминации

5. **Прогнозирование**
   - Для новой даты модель использует:
     - Исторические продажи (лаги)
     - Скользящие статистики до прогнозной даты
     - Временные признаки (день недели, месяц и т.д.)

---

### Использование
1. **Настройка прогноза**
   - Измените дату в переменной `selected_date`:
     ```
     selected_date = '2025-03-08'  # Формат: год-месяц-день
     ```


2. **Результаты**
   - Вывод в консоли:
     ```
     Прогноз на 2025-03-08:
     Ролл 15
     Соус 12
     Салат 10
     ```
   - Графики:
     - Сравнение фактических и прогнозных продаж
     - Прогноз для топ-5 блюд

---

### Результаты
![image](https://github.com/user-attachments/assets/f5e4e789-54d8-469e-86bd-cede4547e452)


**Метрики качества на тестовой выборке:**
```
MAE: 1.56, RMSE: 7.29, R²: 0.98, MAPE: 4.8%
```
![image](https://github.com/user-attachments/assets/829f1368-9380-4dfb-b1d4-d2e788b25ccd)

![image](https://github.com/user-attachments/assets/acf0d1f2-fa7c-4908-bca2-c1cd27def0b9)


